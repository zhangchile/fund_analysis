<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <!-- Load c3.css -->
    <link href="./css/c3.min.css" rel="stylesheet">
    <link href="./bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="./css/bootstrap-datetimepicker.min.css" rel="stylesheet" media="screen">
    

    <!-- Load d3.js and c3.js -->
    <script src="./js/d3.v3.min.js" charset="utf-8"></script>
    <script src="./js/c3.min.js"></script>
    <script type="text/javascript" src="./js/jquery-1.8.3.min.js" charset="UTF-8"></script>
    <script src="./js/datetimepicker.min.js"></script>
    <script type="text/javascript" src="./bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="./js/locales/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script>
    
</head>
<body>
    <div class="container">
        <h2></h2>
        <div class="row">
            <div class="input-group date form_datetime col-md-4" >
                <input class="form-control" size="16" type="text" value="" readonly>
                <span class="input-group-addon"><span class="glyphicon glyphicon-th"></span></span>
            </div>
        </div>
        <p></p>
        <div class="row">
            <div id="chart" style="max-width:1100px;min-height:600px"></div>
        </div>
    </div>

</body>

<script>
$(document).ready(function () {
    var data = [];
    var chart = null;
    var chartOpt = {
        bindto: '#chart',
        data: {
            json: data,
            names: {
                count: '评论量',
                reading: '阅读量'
            },
            keys: {
                x: 'name',
                value:['count','reading']
            },
            axes: {
                reading: 'y2', // ADD,
            },
            order: 'asc',
            labels: true,
            types: {
                count: 'bar',
                reading: 'line'
            },
            onmouseover: function (d) {
                console.log(data[d.index].id)
            },
            onclick: function (d, element) {
                var id = data[d.index].id
                var url = 'http://fund.eastmoney.com/'+id+'.html'
                window.open(url)
            },
            selection: {
                enabled: true
            }
        },
        axis: {
            x: {
                type: 'category',
                height: 90
            },
            y2: {
                show: true, // ADD
                label: '阅读量'
            }
        },
        tooltip: {
            format: {
                title: function (x) {
                    var id = data[x].id
                    return id + '-'+data[x].name; 
                }
            }
        }
    };

    var getDate = function (date) {
        if (date && typeof(date) == 'object') {

        } else {
            date = new Date();
        }
        var y = date.getFullYear();
        var m = date.getMonth() + 1;
        m = m < 10 ? '0' + m : m;
        var d = date.getDate();
        d = d < 10 ? ('0' + d) : d;
        return y + '-' + m + '-' + d;
    };
    $(".form_datetime>input").val( getDate() )
    $(".form_datetime").datetimepicker({
        language:  'zh-CN',
        format: "yyyy-mm-dd",
        autoclose: true,
        todayBtn: false,
        minView:2,
        pickerPosition: "bottom-left"
    }).on('changeDate', function (ev) {
        console.log(getDate(ev.date))
        selectDate = getDate(ev.date)
        $.get('./funddata/fundcount_'+selectDate+'.json', function (res) {
            data = JSON.parse(res)
            if (chart == null) {
                chartOpt.data.json = data
                chart = c3.generate(chartOpt)
            } else {
                chart.load({
                    json: data,
                    keys: {
                        x: 'name',
                        value:['count','reading']
                    },
                })
            }
        })
    })

    $.get('./funddata/fundcount_'+getDate()+'.json', function (res) {
        data = JSON.parse(res)
        chartOpt.data.json = data
        chart = c3.generate(chartOpt)
    })
})
</script>
</html>